<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:MauiAppIntentsSample.ViewModels"
             xmlns:models="clr-namespace:MauiAppIntentsSample.Models"
             x:Class="MauiAppIntentsSample.Views.TaskListPage"
             x:DataType="vm:TaskListViewModel"
             Title="TaskTracker">

    <Shell.TitleView>
        <Grid ColumnDefinitions="*,Auto" Padding="0,0,10,0">
            <Label Text="TaskTracker" FontSize="20" FontAttributes="Bold"
                   VerticalOptions="Center" />
            <Button Grid.Column="1" Text="+" FontSize="24"
                    Command="{Binding AddTaskCommand}"
                    BackgroundColor="Transparent" TextColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource Primary}}"
                    WidthRequest="44" HeightRequest="44" />
        </Grid>
    </Shell.TitleView>

    <RefreshView IsRefreshing="False" Command="{Binding RefreshCommand}">
        <CollectionView ItemsSource="{Binding Tasks}" SelectionMode="None">
            <CollectionView.EmptyView>
                <VerticalStackLayout VerticalOptions="Center" HorizontalOptions="Center" Spacing="10" Padding="20">
                    <Label Text="No tasks yet" FontSize="18" HorizontalOptions="Center" TextColor="Gray" />
                    <Label Text="Tap + to add a task, or ask Siri!" FontSize="14" HorizontalOptions="Center" TextColor="Gray" />
                </VerticalStackLayout>
            </CollectionView.EmptyView>

            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="models:TaskItem">
                    <SwipeView>
                        <SwipeView.RightItems>
                            <SwipeItems>
                                <SwipeItem Text="Done" BackgroundColor="Green"
                                           Command="{Binding Source={RelativeSource AncestorType={x:Type vm:TaskListViewModel}}, Path=ToggleCompleteCommand}"
                                           CommandParameter="{Binding .}" />
                            </SwipeItems>
                        </SwipeView.RightItems>

                        <Frame Padding="12" Margin="8,4" CornerRadius="8" BorderColor="Transparent"
                               BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark=#1C1C1E}">
                            <Frame.GestureRecognizers>
                                <TapGestureRecognizer
                                    Command="{Binding Source={RelativeSource AncestorType={x:Type vm:TaskListViewModel}}, Path=GoToDetailCommand}"
                                    CommandParameter="{Binding .}" />
                            </Frame.GestureRecognizers>

                            <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
                                <Label Grid.Column="0"
                                       Text="{Binding IsCompleted, Converter={StaticResource BoolToCheckConverter}}"
                                       FontSize="20" VerticalOptions="Center" />

                                <VerticalStackLayout Grid.Column="1" Spacing="2">
                                    <Label Text="{Binding Title}" FontSize="16" FontAttributes="Bold"
                                           TextDecorations="{Binding IsCompleted, Converter={StaticResource BoolToStrikethroughConverter}}" />
                                    <HorizontalStackLayout Spacing="8">
                                        <Label Text="{Binding Priority}" FontSize="12" TextColor="Gray" />
                                        <Label Text="·" FontSize="12" TextColor="Gray" />
                                        <Label Text="{Binding Category}" FontSize="12" TextColor="Gray" />
                                    </HorizontalStackLayout>
                                    <Label Text="{Binding DueDate, StringFormat='{0:MMM d, yyyy}'}"
                                           FontSize="12" TextColor="Orange"
                                           IsVisible="{Binding DueDate, Converter={StaticResource IsNotNullConverter}}" />
                                </VerticalStackLayout>

                                <Label Grid.Column="2" Text="›" FontSize="20" TextColor="Gray"
                                       VerticalOptions="Center" />
                            </Grid>
                        </Frame>
                    </SwipeView>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </RefreshView>
</ContentPage>
